{% extends 'base.html' %}

{% block scripts %}
{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script>
//https://stackoverflow.com/questions/1289633/how-to-use-jquery-ui-calendar-date-picker-for-week-rather-than-day
$(function() {
      $('#weekpicker').datepicker({
          format: "yyyy/mm/dd",
          daysOfWeekDisabled: "0,2,3,4,5,6",
          daysOfWeekHighlighted: "1,2,3,4,5",
          calendarWeeks: true,
          showOtherMonths: true,
          selectOtherMonths: true,
          })
          .on('changeDate', function(event) { 
              var startDate = new Date($(this).val());
              var endDate = new Date();
              endDate.setDate(startDate.getDate() + 4);

              $.ajax({
                type: $(this).attr('method'),         
                url: $(this).attr('action'),
                data: { 'startdate':startDate, 
                        'csrfmiddlewaretoken': '{{ csrf_token }}', 
                        'timetable_set-TOTAL_FORMS' : 40, // needed for formset
                        'timetable_set-INITIAL_FORMS': 40,
                        'timetable_set-MAX_NUM_FORMS' : 1000,
                      }, 
              success : function(response) {
                $('#Table-Update-form').html(response);
              },
              error : function(xhr,errmsg,err) {
                  $('#Table-Update-form').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                      " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                  console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
              }})
          });
  });
</script>
{% endblock scripts %}

{% block content %}
<h2>Subject Update</h2>
<div>
  <input id="weekpicker" data-provide="datepicker">
</div>
<form action="{% url 'sub_update' user.id %}" method="post" id="Table-Update-form">
  {% csrf_token %}
  <div class="table-wrap">
  <table class="table table-sm" id="TimeTableUpdate">
    <thead class="thead-light">
      <th scope="col">#</th>
      <th scope="col">Mon</th>
      <th scope="col">Tue</th>
      <th scope="col">Wed</th>
      <th scope="col">Thr</th>
      <th scope="col">Fri</th>
    </thead>
    <tbody>
    {% for course in TimeTables %}
    {% cycle '<tr scope="row"><th> 1 </th>' '' '' '' '' %}
      <td>  
        {{ course.classRoom }}
        {{ course.subject }}
        {{ course.weekday }}
      </td>
    {% cycle '' '' '' '' '</tr>' %}
    {% endfor %}
    </tbody>
  </table>
  </div>
  {{ TimeTables.management_form }}
  {{ TimeTables.non_form_errors.as_ul }}
  <input type="submit" class="btn btn-primary" value="Go Go Gadget &rarr;">
</form>
{% endblock content %}

{% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
  </ul>
  {% endif %}